---
title: "A time-in time-out model"
author: "Brad Duthie"
date: "14/10/2021"
output: pdf_document
bibliography: refs.bib
---


Model
================================

We use a time-in and time-out model in which females and males spend some period of time searching for a mate (time-in) followed by a period of cool down outside the mating pool (time-out).

After mating, we assume that females must spend some time processing offspring ($T_{f}$). Males must spend time out of the mating pool to replenish sperm and search for (fake or real) nuptial gifts. When males return from time out, they encounter females with some probability that is a function of the encounter rate between opposite sex conspecifics ($M$) and the sex ratio ($\beta$; males:females). Mortality occurs for females in ($\mu_{if}$) and out ($\mu_{of}$) of the mating pool, and for males in ($\mu_{im}$) and out ($\mu_{om}$) of the mating pool.

Female fitness
----------------------------

During time-out, females process offspring over a duration of $T_{f}$. When females re-enter the mating pool, they will then encounter males at a rate of $M\sqrt{\beta}$. We assume that female offspring receive a fitness increment of $\gamma \geq 0$ from males that provide a true nuptial gift. Female fitness therefore never decreases by mating with a male with a nuptial gift versus a male without one. Therefore, if a female encounters a male with a nuptial gift, we assume that she will mate with him. But if a female encounters a male with no nuptial gift, then she might accept or reject the male. If she rejects the male, then she will remain in the mating pool. We assume that females cannot distinguish between true and fake nuptial gifts.

We model the probability that a female encounters a male with a nuptial gift (real or fake) after a duration of $T_{N}$ in the mating pool as,

$$\Pr(g) = 1 - e^{-T_{N}\left( M \sqrt{\beta}\right) \left( \Pr(G) + \Pr(F) \right)}.$$

In the above, $\Pr(G)$ and $\Pr(F)$ are the probabilities that males within the mating pool have successfully obtained a true or fake nuptial gift, respectively (see below). We can similarly model the probability that a female encounters a giftless male after $T_{N}$ as,

$$\Pr(n) = 1 - e^{-T_{N} (M \sqrt{\beta}) \Pr(L)}.$$

Note that $\Pr(g)$ and $\Pr(n)$ need not sum to unity, and if $\Pr(L)$ is sufficiently low, then finding a male with a gift will be easier than finding a male without one (i.e., $\Pr(g) > \Pr(n)$).

For simplicity, we assume that offspring sired by a giftless male have a fitness of $1$, so offspring sired by males providing gifts have a fitness of $1 + \gamma$. The inclusive fitness of a female whose offspring are sired by a giftless male is therefore $W_{f}(n) = \kappa (1/2)$, where $\kappa$ is total number of offspring. For simply, we assume $\kappa = 1$, meaning that female fitness is $W_{f}(n) = 1/2$. The inclusive fitness of a female whose offspring are sired by a male with a gift is then,

$$W_{f}(g) = \frac{1}{2}\left(1 + \gamma\frac{\Pr(G)}{\Pr(G) + \Pr(F)}\right).$$
That is, the fitness increment $\gamma$ multiplied by the probability that a male's gift is true.

We can now ask a relevant question for female fitness. Under what conditions should she reject a giftless male? Females will have a higher fitness when they reject a giftless male if $W_{f}(g)$ exceeds $W_{f}(n)$ after accounting for the opportunity cost associated with the additional search time spent in the mating pool $T_{N}$,

$$\Pr(g)\frac{W_{f}(g)}{T_{F} + T_{N}} > \frac{W_{f}(n)}{T_{F}}.$$

Verbally, this is the probability that a female finds a male with a gift that produces higher fitness offspring. Note that we do not need to subtract a term for the fitness loss that might happen if the female fails to find any male. This would be double counting. The right-hand side of the inequality is the expected fitness for the female if she sticks with the male without a nuptial gift. The left-hand side of the inequality is her expected fitness if she rejects that male and spends a time of $T_{N}$ within the mating pool looking for a male with a nuptial gift.


Male fitness
----------------------------


During time-out, males search for a nuptial gift for a time period of $T_{m}$. The probability that a male obtains a true nuptial gift ($G$) during this time is modelled as,

$$\Pr(G) = 1 - e^{-\frac{1}{\alpha_{1}}T_{m}}.$$
```{r, echo = FALSE}
PrGf <- function(Tm, a1){
  vals <- 1 - exp(-(1/a1)*Tm);
  return(vals);
}
```



We assume that a male will always prefer a true nuptial gift to a fake nuptial gift ($F$) or no nuptial gift ($N$), so a fake nuptial gift is only obtained when a true one is not. Hence, the probability that a male obtains a fake nuptial gift during a time period of $T_{m}$ is modelled as, 

$$\Pr(F) = \left(1 - e^{-\frac{1}{\alpha_{2}}T_{m}}\right)e^{-\frac{1}{\alpha_{1}}T_{m}}.$$

```{r, echo = FALSE}
PrFf <- function(Tm, a1, a2){
  vals <- (1 - exp(-(1/a2)*Tm)) * exp(-(1/a1)*Tm);
  return(vals);
}
```

Similarly, we assume that a male will only enter the mating pool with no gift if they are unsuccessful in obtaining a real or fake nuptial gift, so the probability that a male obtains no gift after $T_{m}$ is modelled as,

$$\Pr(L) = e^{-T_{m}\left(\frac{1}{\alpha_{1}} + \frac{1}{\alpha_{2}}\right)}.$$

```{r, echo = FALSE}
PrLf <- function(Tm, a1, a2){
  vals <- 1 - exp(-((1/a1) + (1/a2))*Tm);
  return(vals);
}
```

In the above, $\alpha_{1}$ and $\alpha_{2}$ are parameters modulating the probability of successful search, where we assume $\alpha_{1} < \alpha_{2}$ (i.e., it is more difficult to obtain a real nuptial gift than a fake one). Assume that the fitness increments associated with a real, fake, and no nuptial gift are $V_{G} = 1 + \gamma$, $V_{F} = 1$, and $V_{L} = 1$, respectively. Male fitness can then be defined as the expected fitness increment from their nuptial gift search divided by $T_{m}$ plus the time spent in the mating pool waiting to encounter a mate,

$$W_{m} = \frac{\Pr(G)V_{G} + \Pr(F)V_{F} + \Pr(L)V_{N}}{T_{m} + \frac{\sqrt{\beta}}{M}}.$$

We can simplify this with the fitness values,

$$W_{m} = \frac{\Pr(G)(1 + \gamma) + \Pr(F) + \Pr(L)}{T_{m} + \frac{\sqrt{\beta}}{M}}.$$

```{r, echo = FALSE}
W_mf <- function(PrG, PrF, PrL, gamma, Tm, beta, M){
  val <- ((PrG * (1 + gamma)) + PrF + PrL) / (Tm + (sqrt(beta)/M));
  return(val);
}
W_mf_full  <- function(gamma, Tm, beta_val, M, a1, a2){
  PrG_val  <- PrGf(Tm = Tm, a1 = a1);
  PrF_val  <- PrFf(Tm = Tm, a1 = a1, a2 = a2);
  PrL_val  <- PrLf(Tm = Tm, a1 = a1, a2 = a2);
  W_mf_val <- W_mf(PrG = PrG_val, PrF = PrF_val, PrL = PrL_val, Tm = Tm, 
                   gamma = gamma, beta = beta_val, M = M);
}
```

Initial conditions
----------------------------

We assume that the ancestral condition is one in which no nuptial gifts are sought by males (i.e., $T_{M} = 0$) and females therefore exhibit no choice in males with or without nuptial gifts. Under such conditions, male fitness cannot be affected by female choice, so selection to increase $T_{M} > 0$ must be based solely on $\alpha_{1}$, $\alpha_{2}$, $\sqrt{\beta}/M$, $\gamma$, $m_{im}$, and $m_{om}$. For simplicity, and following @Kokko2006b, we assume $m_{im} = m_{om} = 1$ and $M = 100$. This leaves $\alpha_{1}$, $\alpha_{2}$, $\beta$, and $\gamma$. We assume that the sex ratio at maturation is unity (i.e., equal number of males and females upon maturation). Under this condition, @Kokko2001 show that the operational sex ratio depends on the probability of finding an individual in 'time in',

$$\beta = \frac{\int_{t = 0}^{\infty} P_{IM}(t)dt}{\int_{t = 0}^{\infty} P_{IF}(t)dt}.$$
In the above, $P_{IM}(t)$ and $P_{IF}(t)$ are the probabilities of finding a male and female in 'time in', respectively. @Kokko2001 find these probabilities in terms of the cost of mating. For our purpose, we can find the probability of find a male in 'time in' as the time spent in the mating pol waiting to encounter females ($\sqrt{\beta} / M$) divided by total time in and out,

$$P_{IM}(t) = \frac{\frac{\sqrt{M}}{\beta}}{T_{m} + \frac{\sqrt{M}}{\beta}}.$$
We can define $P_{IF}(t)$ similarly,

$$P_{IF}(t) = \frac{M\sqrt{\beta}}{T_{F} + M\sqrt{\beta}}.$$

We therefore can define $\beta$ as below,

$$\beta = \frac{\frac{\frac{\sqrt{M}}{\beta}}{T_{m} + \frac{\sqrt{M}}{\beta}}}{\frac{M\sqrt{\beta}}{T_{F} + M\sqrt{\beta}}}.$$

The above can be simplified,

$$\beta = \frac{T_{F}\sqrt{\beta} + \beta M}{T_{M}\beta^{2}\sqrt{M} + \beta M}.$$

Note that the equation is recursive, so we need to figure out a closed form solution if possible by figuring out the pattern. Note that this equation makes some intuitive sense. The value of $\beta$ increases with higher female time out ($T_{F}$) and decreases with higher male time out ($T_{M}$). If $T_{F} = T_{M} = 0$, then we have $\beta = 0$; note that @Kokko2001 also multiplied the whole thing by a constant representing sex ratio upon reproductive maturity.

Ignoring the recursion for now and just letting $\beta = 1$ (equal sex ratio in time-in stage), we can move on to seeing how fitness changes with a change in $T_{M}$.

We select some values $\alpha_{1} = 1$ and $\alpha_{2} = 2$. From here, we can initially assume $\gamma = 0$ and plot how $W_{m}$ changes as a function of $T_{M}$.

```{r, echo = FALSE}
W_m  <- function(mom = 1, mim = 1, mof = 1, mif = 1, M = 100, TF, TM, gamma, 
                 a1, a2, beta = 1){
  pG <- PrGf(Tm = TM, a1 = a1);
  pF <- PrFf(Tm = TM, a1 = a1, a2 = a2);
  pL <- PrLf(Tm = TM, a1 = a1, a2 = a2);
  bb <- beta;
  WW <- W_mf_full(gamma = gamma, Tm = TM, beta_val = bb, M = M, a1 = a1, 
                  a2 = a2);
  return(WW)
}
```
  

If we set $T_{F} = 1$, then simulate a range of $T_{M} = \{0.001, 0.002, 1.999, 2.000 \}$, we can calculate $W_{M}$.

```{r, echo = FALSE}
TMvals  <- seq(from = 0.001, to = 2, by = 0.001);
malefit <- W_m(mom = 1, mim = 1, mof = 1, mif = 1, M = 100, TF = 1, gamma = 0,
               a1 = 1, a2 = 2, beta = 1, TM = TMvals);
par(mar = c(5, 5, 1, 1));
plot(x = TMvals, y = malefit, type = "l", lwd = 2, cex.lab = 1.25,
     ylim = c(0, 3),
     xlab = expression(paste("Time out for males (", T[m], ")")),
     ylab = expression(paste("Male fitness (", W[m], ")")));
abline(h = 0, lty = "dotted", lwd = 0.8);
```

Note, however, that this is absolute fitness for a particular period of time out for males. What we are really interested in the change in male fitness given a change in time out. To do this, we can differentiate $W_{m}$ with respect to $T_{m}$ and simplify,

<!--- Mathomatic code

W = (( (1 - e^(-(T/a))) * (G + 1) ) + ( (1 - (e^(-T/b)) ) * (e^(-T/a)) ) + ( e^(-T*((1/a) + (1/b))) ))  /   (T + ((B^(1/2))/M))

Assume beta = 1
--->


$$\frac{\partial W_{m}}{\partial T_{m}} = \frac{M^{2} \left(\gamma e^{\frac{T_{M}}{\alpha_{1}}} - \gamma - 1\right)}{\left(\sqrt{\beta} + T_{M}M \right)^2}.$$

```{r, echo = FALSE}
dWdT <- function(gamma, Tm, beta = 1, M = 100, a1 = 1){
  num <- M*M*(gamma*exp(Tm/a1) - gamma - 1);
  den <- (sqrt(beta) + Tm*M)^2
  val <- num/den
  return(val);
}
```

The plot below shows $\partial W_{m} / \partial T_{m}$ across a range of inclusive fitness increments to offspring associated with a nuptial gift ($\gamma$). Given a sufficiently high value of $\gamma$, males will increase their fitness by increasing their search time, evaluated at $T_{M} = 1$.

```{r, echo = FALSE}
gavals  <- seq(from = 0.001, to = 2, by = 0.001);
malefit <- dWdT(gamma = gavals, Tm = 1, beta = 1, M = 100, a1 = 1);
par(mar = c(5, 5, 1, 1));
plot(x = gavals, y = malefit, type = "l", lwd = 2, cex.lab = 0.9,
     xlab = expression(paste("Inclusive fitness increment with gift (", gamma, ")")),
     ylab = expression(paste("Male fitness change with search time (",partialdiff,"W"[M],"/",partialdiff,"T"[M],")")));
abline(h = 0, lty = "dotted", lwd = 0.8);
```

Again, this makes intuitive sense because unless $\gamma > 0$, fitness can not increase with increased search time. So for our hypothetical example, if $\gamma = 1/2$, then we have `r dWdT(gamma = 1/2, Tm = 1, beta = 1, M = 100, a1 = 1)`.

For females, we can plot $W_{f}(n)/T_{F}$ and $Pr(g) (W_{f}(g) / (T_{F} + T_{N})$ as a function of $\gamma$.

```{r, echo = FALSE}
Wfn <- function(TF = 1){
  return(0.5/TF);
}
WFG <- function(gamma, a1 = 1, a2 = 2, Tf = 1, TN = 1, M = 100, beta = 1, Tm){
  PrG <- 1 - exp(-(1/a1)*Tm);
  PrF <- (1 - exp(-(1/a2)*Tm))*exp(-(1/a1)*Tm);
  Wfg <- 0.5 * (1 + gamma * (PrG / (PrG + PrF)));
  prg <- 1 - exp(-TN * (M / sqrt(beta)) * (PrG + PrF));
  val <- prg * (Wfg / (Tf + TN));
  return(val);
}
```

```{r, echo = FALSE}
gavals  <- seq(from = 0.001, to = 2, by = 0.001);
fmleL   <- rep(Wfn(TF = 1), times = length(gavals));
fmleG   <- WFG(gamma = gavals, Tm = 1, TN = 0.25)
plot(x = gavals, y = fmleG, type = "l", lwd = 2, cex.lab = 1, 
     ylim = c(0, 1.2),
     xlab = expression(paste("Offspring fitness increment with gift (", gamma, ")")),
     ylab = expression(paste("Female fitness (", W[f], ")")))
points(x = gavals, y = fmleL, type = "l", lwd = 2, col = "red");
abline(h = 0, lty = "dotted", lwd = 0.8);
```

Here the intersection of the black and red lines identifies the inclusive fitness increment for offspring $\gamma$ at which females do not benefit anymore from accepting a giftless male versus rejecting the giftless male in search of a new one. Where the black line is higher, females benefit by rejecting the giftless male in favour of searching for a new male. Where the red line is higher, females benefit by mating with the giftless male and entering the time out stage.

<!--- Set the inequalities to solve for gamma

Prg * (Wfg / (TF + TN)) > WFn / TF

Prg = (1 - e^(-N (M * (B^(1/2)) (PrG + PrF))))
Wfg = (1/2 * (1 + (gamma * (PrG) / (PrG + PrF))))
Wfn = (1/2)
PrG = (1 - e^(-(T/a)))
PrF = ((1 - e^(-(T/b))) * e^(-(T/a)))

(1 - e^(-N (M * (B^(1/2)) ((1 - e^(-(T/a))) + ((1 - e^(-(T/b))) * e^(-(T/a))))))) * ((1/2 * (1 + (gamma * ((1 - e^(-(T/a)))) / ((1 - e^(-(T/a))) + ((1 - e^(-(T/b))) * e^(-(T/a))))))) / (F + N)) = (1/2) / (F)

--->



```{r, echo = FALSE}
gamma_star <- function(TN, M, beta, TF, a1, a2, TM){
  top1 <- exp(-(TM/a1)) * exp(-(TM/a2)) - 1;
  top2 <- exp(-(TM*(a2 + a1))/(a1*a2)) * TF + TN;
  bot1 <- TF;
  bot2 <- exp(-(TM*(a2 + a1))/(a1*a2)) - 1;
  bot3 <- exp(-(TM/a1)) - 1;
  topp <- top1 * top2;
  bott <- bot1 * bot2 * bot3;
  gst  <- -1*topp/bott;
  return(gst);
}
```

```{r, echo = FALSE}
ts <- seq(from = 0, to = 4, by = 0.001);
yy <- gamma_star(TN = ts, M = 100, beta = 1, TF = 1, a1 = 1, a2 = 2, TM = 1);
par(mar = c(5, 5, 1, 1));
plot(x = ts, y = yy, type = "l", lwd = 2, cex.lab = 1, ylim = c(0, 8),
     xlab = expression(paste("Female additional search time (", "T"[N], ")")),
     ylab = expression(paste("Gain needed for fitness increase (", gamma, "*)")));
abline(h = 0, lty = "dotted", lwd = 0.8);
```

Upon rejecting a focal male, females will search for a new male for a duration of time $T_{N}$. The above plot illustrates how much of an fitness benefit provided to offspring ($\gamma$) is needed for the focal female to justify the new search duration ($\gamma^{*}$) given $T_{F} = 1$ and $T_{M} = 1$. Note that upon rejecting a focal male, there is a nonzero probability that the focal female will fail to find a new male entirely after $T_{N}$, so there is no reason to expect the line above to pass through the origin. The value of $\gamma^{*}$ when $T_{N} = 0$ is $\gamma^{*} =$ `r yy[1]`. As a focal female invests more time, a larger fitness increment to her offspring is needed for rejecting the focal male to be beneficial.

Below, we show how male search time affects $\gamma^{*}$ when $T_{N} = 1$ and $T_{M} = 1$.

```{r, echo = FALSE}
ts <- seq(from = 0.001, to = 4, by = 0.001);
yy <- gamma_star(TN = 1, M = 100, beta = 1, TF = 1, a1 = 1, a2 = 2, TM = ts);
plot(x = ts, y = yy, type = "l", lwd = 2, cex.lab = 1, ylim = c(0, 8),
     xlab = expression(paste("Male search time (", "T"[M], ")")),
     ylab = expression(paste("Gain needed for fitness increase (", gamma, "*)")));
abline(h = 0, lty = "dotted", lwd = 0.8);
```


References
======================
